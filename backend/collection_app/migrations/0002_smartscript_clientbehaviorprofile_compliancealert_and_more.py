# Generated by Django 6.0.1 on 2026-01-15 16:18

import django.db.models.deletion
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('collection_app', '0001_initial'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='SmartScript',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=200, verbose_name='Название скрипта')),
                ('target_psychotype', models.CharField(choices=[('forgetful', 'Забыл / Прокрастинирует'), ('unwilling', 'Может платить, но не хочет'), ('unable', 'Хочет платить, но не может'), ('toxic', 'Токсичный / Конфликтный'), ('cooperative', 'Готов к диалогу'), ('any', 'Универсальный')], default='any', max_length=20, verbose_name='Целевой психотип')),
                ('scenario', models.CharField(choices=[('soft_reminder', 'Мягкое напоминание'), ('firm_demand', 'Жёсткое требование'), ('empathy', 'Эмпатичный подход'), ('restructure_offer', 'Предложение реструктуризации'), ('discount_offer', 'Предложение скидки'), ('payment_holiday', 'Кредитные каникулы'), ('last_warning', 'Последнее предупреждение')], max_length=30, verbose_name='Сценарий')),
                ('opening_phrases', models.JSONField(default=list, verbose_name='Вступительные фразы')),
                ('key_phrases', models.JSONField(default=list, verbose_name='Ключевые фразы (работающие)')),
                ('objection_handlers', models.JSONField(default=dict, verbose_name='Обработка возражений')),
                ('closing_phrases', models.JSONField(default=list, verbose_name='Завершающие фразы')),
                ('times_used', models.IntegerField(default=0, verbose_name='Использований')),
                ('success_count', models.IntegerField(default=0, verbose_name='Успешных применений')),
                ('success_rate', models.FloatField(default=0, verbose_name='Процент успеха')),
                ('avg_ptp_amount', models.DecimalField(decimal_places=2, default=0, max_digits=12, verbose_name='Средняя сумма PTP')),
                ('is_active', models.BooleanField(default=True, verbose_name='Активен')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='Создан')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='Обновлён')),
            ],
            options={
                'verbose_name': 'Умный скрипт',
                'verbose_name_plural': 'Умные скрипты',
            },
        ),
        migrations.CreateModel(
            name='ClientBehaviorProfile',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('psychotype', models.CharField(choices=[('forgetful', 'Забыл / Прокрастинирует'), ('unwilling', 'Может платить, но не хочет'), ('unable', 'Хочет платить, но не может'), ('toxic', 'Токсичный / Конфликтный'), ('cooperative', 'Готов к диалогу')], default='forgetful', max_length=20, verbose_name='Психотип')),
                ('psychotype_confidence', models.FloatField(default=0.5, verbose_name='Уверенность в психотипе')),
                ('payment_discipline_score', models.FloatField(default=0.5, verbose_name='Оценка платёжной дисциплины')),
                ('avg_days_overdue', models.FloatField(default=0, verbose_name='Средняя просрочка (дней)')),
                ('payments_on_time_ratio', models.FloatField(default=0, verbose_name='Доля платежей вовремя')),
                ('best_contact_hour', models.IntegerField(default=14, verbose_name='Лучший час для контакта')),
                ('best_contact_day', models.IntegerField(default=2, verbose_name='Лучший день недели')),
                ('preferred_channel', models.CharField(choices=[('phone', 'Звонок'), ('sms', 'СМС'), ('whatsapp', 'WhatsApp'), ('email', 'Email'), ('push', 'Push-уведомление')], default='phone', max_length=20, verbose_name='Предпочтительный канал')),
                ('job_changed_recently', models.BooleanField(default=False, verbose_name='Смена работы недавно')),
                ('income_dropped', models.BooleanField(default=False, verbose_name='Падение дохода')),
                ('activity_dropped', models.BooleanField(default=False, verbose_name='Резкое падение активности')),
                ('multiple_credits', models.BooleanField(default=False, verbose_name='Много кредитов одновременно')),
                ('total_contacts', models.IntegerField(default=0, verbose_name='Всего контактов')),
                ('successful_contacts', models.IntegerField(default=0, verbose_name='Успешных контактов')),
                ('promises_kept_ratio', models.FloatField(default=0, verbose_name='Доля выполненных обещаний')),
                ('avg_promise_delay', models.FloatField(default=0, verbose_name='Средняя задержка по обещаниям (дней)')),
                ('return_probability', models.FloatField(default=0.5, verbose_name='Вероятность возврата')),
                ('expected_return_days', models.IntegerField(default=30, verbose_name='Ожидаемый срок возврата (дней)')),
                ('strategic_recommendation', models.CharField(choices=[('continue', 'Продолжать взыскание'), ('restructure', 'Предложить реструктуризацию'), ('soft_collection', 'Мягкое взыскание'), ('legal', 'Передать юристам'), ('sell', 'Продать портфель'), ('write_off', 'Списать')], default='continue', max_length=20, verbose_name='Стратегическая рекомендация')),
                ('last_updated', models.DateTimeField(auto_now=True, verbose_name='Последнее обновление')),
                ('client', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='behavior_profile', to='collection_app.client')),
            ],
            options={
                'verbose_name': 'Поведенческий профиль',
                'verbose_name_plural': 'Поведенческие профили',
            },
        ),
        migrations.CreateModel(
            name='ComplianceAlert',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('severity', models.CharField(choices=[('info', 'Информация'), ('warning', 'Предупреждение'), ('critical', 'Критическое'), ('violation', 'Нарушение')], max_length=20, verbose_name='Серьёзность')),
                ('alert_type', models.CharField(choices=[('pressure', 'Давление на клиента'), ('threat', 'Угрозы'), ('disclosure', 'Разглашение информации'), ('timing', 'Звонок в неразрешённое время'), ('frequency', 'Превышена частота контактов'), ('script_deviation', 'Отклонение от скрипта'), ('prohibited_words', 'Запрещённые слова'), ('rudeness', 'Грубость')], max_length=30, verbose_name='Тип алерта')),
                ('description', models.TextField(verbose_name='Описание')),
                ('evidence', models.TextField(blank=True, verbose_name='Доказательство (цитата)')),
                ('timestamp_in_call', models.IntegerField(blank=True, null=True, verbose_name='Секунда в разговоре')),
                ('status', models.CharField(choices=[('new', 'Новый'), ('reviewed', 'Рассмотрен'), ('confirmed', 'Подтверждён'), ('false_positive', 'Ложное срабатывание'), ('escalated', 'Эскалирован')], default='new', max_length=20, verbose_name='Статус')),
                ('review_comment', models.TextField(blank=True, verbose_name='Комментарий проверки')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='Создан')),
                ('intervention', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='compliance_alerts', to='collection_app.intervention')),
                ('operator', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='compliance_alerts', to='collection_app.operator')),
                ('reviewed_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL, verbose_name='Рассмотрел')),
            ],
            options={
                'verbose_name': 'Алерт комплаенса',
                'verbose_name_plural': 'Алерты комплаенса',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='ConversationAnalysis',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('transcript', models.TextField(blank=True, verbose_name='Транскрипция')),
                ('client_sentiment', models.CharField(choices=[('very_negative', 'Очень негативный'), ('negative', 'Негативный'), ('neutral', 'Нейтральный'), ('positive', 'Позитивный'), ('very_positive', 'Очень позитивный')], default='neutral', max_length=20, verbose_name='Настроение клиента')),
                ('operator_sentiment', models.CharField(choices=[('very_negative', 'Очень негативный'), ('negative', 'Негативный'), ('neutral', 'Нейтральный'), ('positive', 'Позитивный'), ('very_positive', 'Очень позитивный')], default='neutral', max_length=20, verbose_name='Настроение оператора')),
                ('effective_phrases', models.JSONField(default=list, verbose_name='Эффективные фразы')),
                ('ineffective_phrases', models.JSONField(default=list, verbose_name='Неэффективные фразы')),
                ('compliance_score', models.FloatField(default=1.0, verbose_name='Оценка комплаенса')),
                ('compliance_violations', models.JSONField(default=list, verbose_name='Нарушения комплаенса')),
                ('talk_ratio', models.FloatField(default=1.0, verbose_name='Соотношение речи (оператор/клиент)')),
                ('interruption_count', models.IntegerField(default=0, verbose_name='Перебиваний')),
                ('silence_ratio', models.FloatField(default=0, verbose_name='Доля пауз')),
                ('ptp_achieved', models.BooleanField(default=False, verbose_name='Получено PTP')),
                ('ptp_amount', models.DecimalField(decimal_places=2, default=0, max_digits=12, verbose_name='Сумма PTP')),
                ('analyzed_at', models.DateTimeField(auto_now_add=True, verbose_name='Дата анализа')),
                ('intervention', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='analysis', to='collection_app.intervention')),
            ],
            options={
                'verbose_name': 'Анализ разговора',
                'verbose_name_plural': 'Анализы разговоров',
            },
        ),
        migrations.CreateModel(
            name='NextBestAction',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='Создано')),
                ('recommended_datetime', models.DateTimeField(verbose_name='Рекомендуемое время контакта')),
                ('urgency', models.IntegerField(default=3, verbose_name='Срочность (1-5)')),
                ('recommended_channel', models.CharField(choices=[('phone', 'Звонок'), ('sms', 'СМС'), ('whatsapp', 'WhatsApp'), ('email', 'Email'), ('push', 'Push-уведомление')], max_length=20, verbose_name='Рекомендуемый канал')),
                ('recommended_scenario', models.CharField(choices=[('soft_reminder', 'Мягкое напоминание'), ('firm_demand', 'Жёсткое требование'), ('empathy', 'Эмпатичный подход'), ('restructure_offer', 'Предложение реструктуризации'), ('discount_offer', 'Предложение скидки'), ('payment_holiday', 'Кредитные каникулы'), ('last_warning', 'Последнее предупреждение')], max_length=30, verbose_name='Рекомендуемый сценарий')),
                ('recommended_offer', models.CharField(choices=[('none', 'Без предложения'), ('discount_10', 'Скидка 10%'), ('discount_20', 'Скидка 20%'), ('discount_50', 'Скидка 50%'), ('restructure_6m', 'Реструктуризация на 6 мес'), ('restructure_12m', 'Реструктуризация на 12 мес'), ('holiday_1m', 'Каникулы 1 месяц'), ('holiday_3m', 'Каникулы 3 месяца'), ('partial_write_off', 'Частичное списание')], default='none', max_length=30, verbose_name='Рекомендуемое предложение')),
                ('max_discount_percent', models.FloatField(default=0, verbose_name='Макс. скидка %')),
                ('reasoning', models.TextField(blank=True, verbose_name='Обоснование рекомендации')),
                ('confidence_score', models.FloatField(default=0.5, verbose_name='Уверенность в рекомендации')),
                ('status', models.CharField(choices=[('pending', 'Ожидает'), ('accepted', 'Принята'), ('rejected', 'Отклонена'), ('executed', 'Выполнена'), ('expired', 'Истекла')], default='pending', max_length=20, verbose_name='Статус')),
                ('outcome_successful', models.BooleanField(blank=True, null=True, verbose_name='Успешный результат')),
                ('client', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='nba_recommendations', to='collection_app.client')),
                ('credit', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='nba_recommendations', to='collection_app.credit')),
            ],
            options={
                'verbose_name': 'Рекомендация NBA',
                'verbose_name_plural': 'Рекомендации NBA',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='ReturnForecast',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('calculated_at', models.DateTimeField(auto_now_add=True, verbose_name='Дата расчёта')),
                ('return_probability', models.FloatField(verbose_name='Вероятность возврата')),
                ('partial_return_probability', models.FloatField(default=0, verbose_name='Вероятность частичного возврата')),
                ('expected_return_amount', models.DecimalField(decimal_places=2, max_digits=12, verbose_name='Ожидаемая сумма возврата')),
                ('expected_return_date', models.DateField(blank=True, null=True, verbose_name='Ожидаемая дата возврата')),
                ('expected_return_days', models.IntegerField(default=30, verbose_name='Ожидаемый срок (дней)')),
                ('recommendation', models.CharField(choices=[('continue_soft', 'Продолжить мягкое взыскание'), ('continue_hard', 'Усилить давление'), ('restructure', 'Предложить реструктуризацию'), ('legal', 'Передать в юридический'), ('sell', 'Продать коллекторам'), ('write_off', 'Списать как безнадёжный')], max_length=30, verbose_name='Рекомендация')),
                ('recommendation_confidence', models.FloatField(default=0.5, verbose_name='Уверенность в рекомендации')),
                ('positive_factors', models.JSONField(default=list, verbose_name='Позитивные факторы')),
                ('negative_factors', models.JSONField(default=list, verbose_name='Негативные факторы')),
                ('npv_continue', models.DecimalField(decimal_places=2, default=0, max_digits=12, verbose_name='NPV при продолжении взыскания')),
                ('npv_sell', models.DecimalField(decimal_places=2, default=0, max_digits=12, verbose_name='NPV при продаже')),
                ('npv_write_off', models.DecimalField(decimal_places=2, default=0, max_digits=12, verbose_name='NPV при списании')),
                ('credit', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='forecasts', to='collection_app.credit')),
            ],
            options={
                'verbose_name': 'Прогноз возврата',
                'verbose_name_plural': 'Прогнозы возврата',
                'ordering': ['-calculated_at'],
            },
        ),
    ]
